#!/bin/sh

LIST="documentation/file_list.txt"
DOC="documentation/documentation_state.txt"
REPORT="documentation/documentation_report.txt"

echo "Documentation status report" > "$REPORT"
echo "---------------------------" >> "$REPORT"

if [ ! -f "$DOC" ]; then
    echo "‚ùå documentation_state.txt missing" >> "$REPORT"
    exit 0
fi

while read -r line; do
    [ "$line" = "Generating file hash list..." ] && continue
    FILE=$(echo "$line" | cut -d '|' -f1 | xargs)
    HASH=$(echo "$line" | cut -d '|' -f2 | xargs)

    DOC_HASH=$(grep "^$FILE" "$DOC" | cut -d '|' -f2 | xargs)

    if [ -z "$DOC_HASH" ]; then
        echo "üìÑ $FILE ‚Üí NOT DOCUMENTED" >> "$REPORT"
    elif [ "$HASH" != "$DOC_HASH" ]; then
        echo "‚ö†Ô∏è  $FILE ‚Üí OUTDATED DOC" >> "$REPORT"
    else
        echo "‚úÖ $FILE ‚Üí OK" >> "$REPORT"
    fi
done < "$LIST"

echo "documentation_report.txt generated."


# --- 2. Export des infos de build ---
if command -v python >/dev/null 2>&1; then
    python tools/export_debug_info.py
elif command -v python3 >/dev/null 2>&1; then
    python3 tools/export_debug_info.py
else
    echo "‚ùå Python not found, build info not generated"
fi

echo "‚úÖ Post-commit hook finished"